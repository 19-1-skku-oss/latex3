%
% Copyright (C) 2015 Qing Lee
%

\documentclass{book}
\input{regression-test}
\AUTHOR{Qing Lee}

\usepackage{expl3}

\START

\ExplSyntaxOn

\bool_if:nF
  {
       \sys_if_engine_pdftex_p:
    || \sys_if_engine_xetex_p:
    || \sys_if_engine_luatex_p:
  }
  {
    \msg_term:n { Not-supported-engine! }
    \END
  }

%% We omit every message in tex running, but write a marker to .tlg before the final
%% \@@end to indicate running without any errors since engine option "-halt-on-error"
%% is active. In pdftex testing, there will be a "Font cyberb75 at 632 not found" error
%% after \typeout{END-TEST-LOG} due to the lack of actual actual truetype fonts.
%% \pdfdraftmode is helpless in this case. We can disable \shipout to avoid this error.
%% But it is not essential in our test.
\OMIT
\AtEndDocument
  {
    \tl_put_left:cn { @@end }
      {
        \TIMO
        \msg_term:n { OK,~ctex-test-passed! }
      }
  }

%% SVN keywrod ID is not expanded by git, so the date of xtemplate is 0000/00/00.
%% We need to change it to the correct value to make xeCJK happy.
\sys_if_engine_xetex:T
  {
    \usepackage { filehook }
    \AtEndOfPackageFile * { xtemplate }
      {
        \use:c { @ifpackagelater } { xtemplate } { 0000/00/01 }
          { }
          { \cs_set_eq:cc { ver@xtemplate.sty } { ver@expl3.sty } }
      }
  }

\ExplSyntaxOff

\usepackage[UTF8, heading, fontset = none]{ctex}

%% use lm fonts instead of fandol for testing
\ExplSyntaxOn
\sys_if_engine_pdftex:F
  {
    \setCJKmainfont { lmroman10-regular.otf }
    \setCJKsansfont { lmsans10-regular.otf }
    \setCJKmonofont { lmmono10-regular.otf }
  }
\ExplSyntaxOff


\begin{document}

\chapter{测试（test）}

Hello world! 你好，世界！

一二三ABC

\end{document}
