%
% Copyright (C) 2017 LaTeX3 Project
%

\documentclass{minimal}
\input{regression-test}
\RequirePackage[log-functions, check-declarations]{expl3}

\begin{document}

\START
\AUTHOR{Bruno Le Floch}
\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Safe~array~operations }
  {
    \intarray_new:Nn \l_tmpa_intarray { 123 }
    \group_begin:
    \intarray_gset:Nnn \l_tmpa_intarray { 1 } { 100 }
    \intarray_gset:Nnn \l_tmpa_intarray { 2 } { -200 }
    \intarray_gset:Nnn \l_tmpa_intarray { 1 } { -10 }
    \intarray_gset:Nnn \l_tmpa_intarray { 123 } { 12345 }
    \group_end:
    \TYPE { \intarray_count:N \l_tmpa_intarray }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 1 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 2 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 53 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 123 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Safe~array~operations~with~errors }
  {
    \intarray_new:Nn \l_tmpa_intarray { 12 }
    \group_begin:
    \intarray_gset:Nnn \l_tmpa_intarray { 0 } { 2000000000 }
    \intarray_gset:Nnn \l_tmpa_intarray { 1 } { -2000000000 }
    \intarray_gset:Nnn \l_tmpa_intarray { 13 } { -2000000000 }
    \group_end:
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 0 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 1 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 12 } }
    \TYPE { \intarray_item:Nn \l_tmpa_intarray { 13 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Unsafe~array~operations~with~errors }
  {
    \intarray_new:Nn \l_tmpb_intarray { 15 }
    \group_begin:
    \__kernel_intarray_gset:Nnn \l_tmpb_intarray { 0 } { 2000000000 }
    \__kernel_intarray_gset:Nnn \l_tmpb_intarray { 1 } { -2000000000 }
    \__kernel_intarray_gset:Nnn \l_tmpb_intarray { 16 } { 123456 }
    \group_end:
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 0 } }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 1 } }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 15 } }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 16 } }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 17 } }
    \__kernel_intarray_gset:Nnn \l_tmpb_intarray { 17 } { 1234567 }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 17 } }
    \intarray_new:Nn \l_tmpc_intarray { -1 }
    \__kernel_intarray_gset:Nnn \l_tmpb_intarray { 18 } { 12345678 }
    \TYPE { \__kernel_intarray_item:Nn \l_tmpb_intarray { 18 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\int_gadd:Nn \g__intarray_font_int { 100000 } % to make sure nothing is suppressed accidentally by scaling the font.
\TEST { Any~stray~non-zero? }
  {
    \intarray_new:Nn \l_tmpd_intarray { 25 }
    \int_step_inline:nnnn { 1 } { 1 } { \intarray_count:N \l_tmpd_intarray }
      { \int_compare:nNnF { \intarray_item:Nn \l_tmpd_intarray {#1} } = 0 { \TYPE {#1} } }
  }

\END
