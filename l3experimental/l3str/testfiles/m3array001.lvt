%
% Copyright (C) 2017 LaTeX3 Project
%

\documentclass{minimal}
\input{regression-test}
\RequirePackage[log-functions, check-declarations]{expl3}
\RequirePackage{l3array}

\begin{document}

\START
\AUTHOR{Bruno Le Floch}
\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Safe~array~operations }
  {
    \__array_new:Nn \l_tmpa_array { 123 }
    \group_begin:
    \__array_gset:Nnn \l_tmpa_array { 1 } { 100 }
    \__array_gset:Nnn \l_tmpa_array { 2 } { -200 }
    \__array_gset:Nnn \l_tmpa_array { 1 } { -10 }
    \__array_gset:Nnn \l_tmpa_array { 123 } { 12345 }
    \group_end:
    \TYPE { \__array_count:N \l_tmpa_array }
    \TYPE { \__array_item:Nn \l_tmpa_array { 1 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 2 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 53 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 123 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Safe~array~operations~with~errors }
  {
    \__array_new:Nn \l_tmpa_array { 12 }
    \group_begin:
    \__array_gset:Nnn \l_tmpa_array { 0 } { 2000000000 }
    \__array_gset:Nnn \l_tmpa_array { 1 } { -2000000000 }
    \__array_gset:Nnn \l_tmpa_array { 13 } { -2000000000 }
    \group_end:
    \TYPE { \__array_item:Nn \l_tmpa_array { 0 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 1 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 12 } }
    \TYPE { \__array_item:Nn \l_tmpa_array { 13 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TEST { Unsafe~array~operations~with~errors }
  {
    \__array_new:Nn \l_tmpb_array { 15 }
    \group_begin:
    \__array_gset_fast:Nnn \l_tmpb_array { 0 } { 2000000000 }
    \__array_gset_fast:Nnn \l_tmpb_array { 1 } { -2000000000 }
    \__array_gset_fast:Nnn \l_tmpb_array { 16 } { 123456 }
    \group_end:
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 0 } }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 1 } }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 15 } }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 16 } }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 17 } }
    \__array_gset_fast:Nnn \l_tmpb_array { 17 } { 1234567 }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 17 } }
    \__array_new:Nn \l_tmpc_array { -1 }
    \__array_gset_fast:Nnn \l_tmpb_array { 18 } { 12345678 }
    \TYPE { \__array_item_fast:Nn \l_tmpb_array { 18 } }
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\int_gadd:Nn \g__array_font_int { 100000 } % to make sure nothing is suppressed accidentally by scaling the font.
\TEST { Any~stray~non-zero? }
  {
    \__array_new:Nn \l_tmpd_array { 25 }
    \int_step_inline:nnnn { 1 } { 1 } { \__array_count:N \l_tmpd_array }
      { \int_compare:nNnF { \__array_item:Nn \l_tmpd_array {#1} } = 0 { \TYPE {#1} } }
  }

\END
